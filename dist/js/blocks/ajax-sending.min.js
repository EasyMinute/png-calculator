/******/ (() => { // webpackBootstrap
/*!***********************************!*\
  !*** ./js/blocks/ajax-sending.js ***!
  \***********************************/
document.addEventListener('DOMContentLoaded', function () {
  var form = document.getElementById('png-calculator-form'); // Replace with your form's ID
  if (form) {
    form.addEventListener('submit', function (e) {
      var _document$getElementB, _document$getElementB2;
      e.preventDefault();
      var formData = new FormData(form);
      var totalPrice = ((_document$getElementB = document.getElementById('totalPrice')) === null || _document$getElementB === void 0 ? void 0 : _document$getElementB.textContent.trim()) || '0';
      var totalSum = ((_document$getElementB2 = document.getElementById('totalSum')) === null || _document$getElementB2 === void 0 ? void 0 : _document$getElementB2.textContent.trim()) || '0';

      // Append them to FormData
      formData.append('totalPrice', totalPrice);
      formData.append('totalSum', totalSum);

      // Extract values from dynamically created selects
      var printFormats = [];
      var printTypes = [];
      document.querySelectorAll('.printFormat').forEach(function (select) {
        printFormats.push(select.value);
      });
      document.querySelectorAll('.printType').forEach(function (select) {
        printTypes.push(select.value);
      });

      // Append to FormData as arrays
      formData.append('printFormats', JSON.stringify(printFormats));
      formData.append('printTypes', JSON.stringify(printTypes));
      var xhr = new XMLHttpRequest();

      // Adding a special parameter 'action' to indicate which action to call
      formData.append('action', 'send_to_crm_action');

      // Debugging
      console.log('FormData:', Object.fromEntries(formData.entries()));
      xhr.open('POST', ajaxurl, true); // WordPress automatically provides `ajaxurl` in admin.
      xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
          // alert('Форму надіслано!');
          console.log('CRM data sent successfully:', xhr.responseText);
          // **Clear all form fields**
          form.reset();

          // **Clear dynamically created selects**
          document.querySelectorAll('.printFormat, .printType').forEach(function (select) {
            select.value = '';
          });
          // **Clear displayed total price & total sum (if necessary)**
          if (document.getElementById('totalPrice')) {
            document.getElementById('totalPrice').textContent = '0';
          }
          if (document.getElementById('totalSum')) {
            document.getElementById('totalSum').textContent = '0';
          }
          document.querySelectorAll('.pngcalc__step').forEach(function (stepElement) {
            stepElement.classList.add('hidden');
          });
          var targetStep = document.querySelector(".pngcalc__step[data-step=\"final\"]");
          targetStep.classList.remove('hidden');
        } else if (xhr.readyState === 4) {
          alert('Помилка надсилання');
          console.error('Error sending data to CRM:', xhr.status, xhr.statusText);
        }
      };
      xhr.send(formData);
    });
  }
});
/******/ })()
;